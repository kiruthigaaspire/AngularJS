<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Exercise 9</title>
    <script src="bower_components/angular/angular.js"></script>
	<style>
	    .list_data { margin-bottom: 2rem }
	    table, th, td { border: 1px solid #AAA }
	    th { cursor: pointer }

    </style>
  </head>
  <body ng-app="myApp"  ng-controller="myCtrl">

	<div class="list_data">
        <h1>List of Books</h1>
		<a href="" ng-click="searchType='basic'">Basic search</a>
		<a href="" ng-click="searchType='advanced'">Advanced search</a>
		
		<div ng-show="searchType == 'basic'">
			<label>Basic search: </label> <input type="text" ng-model="searchBasicText">
		</div>
		
		<div ng-show="searchType == 'advanced'">
			<label>Book Name: </label> <input type="text" ng-model="searchBookName">
		
			<label>Author Name: </label> <select ng-model="searchAuthorName" 
			ng-options="book.authorname as book.authorname for book in bookList">
			<option value="">--All--</option>
		</select>
		</div>

		
		<table>
            <tr>
                <th ng-click="type = 'bookname'; reverse = !reverse">Book Name</th>
                <th ng-click="type = 'authorname'; reverse = !reverse">Author Name</th>
                <th ng-click="type = 'rollnumber'; reverse = !reverse">Roll Number</th>
                <th ng-click="type = 'quantity'; reverse = !reverse">Quantity</th>
				<th ng-click="type = 'status'; reverse = !reverse">Status</th>
                <th>Action</th>
            </tr>
            <tr ng-repeat="book in bookList | orderBy:type:reverse |
					filter: searchBasicText |
					filter:{'bookname': searchBookName, 'authorname': searchAuthorName ||undefined}
					">
                <td>{{book.bookname}}</td>
                <td>{{book.authorname}}</td>
                <td>{{book.rollnumber}}</td>
                <td>{{book.quantity}}</td>
				<td>{{book.status}}</td>
                <td><button ng-click="editBook($index)">Edit</button><button ng-click="deleteBook($index)">Delete</button></td>
            </tr>
        </table>
        <button ng-show="history.length > 0" ng-click="undoDelete()">Undo Delete</button>
    </div>
  
    <div class="add_data" ng-show="showForm == 'add'">
        <h1>Add Book</h1>
        <form name="addbookform" ng-submit="addBook(addbookform.$valid)">
            <div class="field">
                <label for="bookname">Book Name: </label>
                <input id="bookname" type="text" ng-model="bookname" required>
            </div>
			<div class="field">
                <label for="authorname">Author Name: </label>
                <input id="authorname" type="text" ng-model="authorname" required>
            </div>
			<div class="field">
                <label for="rollnumber">Roll Number: </label>
                <input id="rollnumber" type="number" ng-model="rollnumber" required ng-minlength="3" ng-maxlength="6"> (Min length: 3 , Max length: 6)
            </div>
			<div class="field">
                <label for="quantity">Quantity: </label>
                <input id="quantity" type="number" ng-model="quantity" required>
            </div>
			<div class="field">
                <label for="status">Status: </label>
                <select id="status" ng-model="status">
					<option ng-repeat="x in statusOptions">{{x}}</option>
				</select>
            </div>

            <div class="action">
                <button type="submit">Add</button>
            </div>
        </form>
    </div>

	<div class="add_data" ng-show="showForm == 'edit'">
        <h1>Edit Book</h1>
        <form name="editbookform" ng-submit="updateBook(updateIndex, editbookform.$valid)">
            <div class="field">
                <label for="bookname">Book Name: </label>
                <input id="bookname" type="text" ng-model="bookname" required>
            </div>
			<div class="field">
                <label for="authorname">Author Name: </label>
                <input id="authorname" type="text" ng-model="authorname" required>
            </div>
			<div class="field">
                <label for="rollnumber">Roll Number: </label>
                <input id="rollnumber" type="number" ng-model="rollnumber" required ng-minlength="3" ng-maxlength="6"> (Min length: 3 , Max length: 6)
            </div>
			<div class="field">
                <label for="quantity">Quantity: </label>
                <input id="quantity" type="number" ng-model="quantity" required>
            </div>
			<div class="field">
                <label for="status">Status: </label>
                <select id="status" ng-model="status">
					<option ng-repeat="x in statusOptions">{{x}}</option>
				</select>
            </div>
            <div class="action">
                <button type="submit">Update</button>
            </div>
        </form>
    </div>

	<button ng-click="resetData()">Clear form</button>
	
	<script>
	
		var app = angular.module("myApp", []);
		
		app.controller('myCtrl', function($scope) {
			// Historical data
        	$scope.history = [];
			
			$scope.bookname = '';
			$scope.authorname = '';
			$scope.rollnumber = '';
			$scope.quantity = '';
			$scope.status = 'Available';
			$scope.statusOptions = ['Available', 'Not Available'];
			
			$scope.updateIndex = '';
			$scope.showForm = 'add';
			
			//Filtering
			$scope.searchType = 'basic';
			$scope.searchBasicText = '';
			$scope.searchBookName = '';
			$scope.searchAuthorName = '';
			
			
			// Default data (can be loaded from a database)
			$scope.bookList = [
				{
					bookname : 'Book 1',
					authorname: 'Author 1',
					rollnumber: '1001',
					quantity: '10',
					status: "Available"
				},
				{
					bookname : 'Book 2',
					authorname: 'Author 2',
					rollnumber: '1002',
					quantity: '10',
					status: "Available"
				},
				{
					bookname : 'Book 3',
					authorname: 'Author 3',
					rollnumber: '1003',
					quantity: '0',
					status: "Not Available"
				},
				{
					bookname : 'Book 4',
					authorname: 'Author 4',
					rollnumber: '1004',
					quantity: '10',
					status: "Available"
				},
				{
					bookname : 'Book 5',
					authorname: 'Author 5',
					rollnumber: '1005',
					quantity: '0',
					status: "Not Available"
				}
			];
				
			// Delete data
			$scope.deleteBook = function (index) {
				// Remove first / oldest element from history if it reaches maximum capacity of 10 records
				if ($scope.history.length === 10)
					$scope.history.shift();
				// Add deleted record to historical records
				$scope.history.push($scope.bookList[index]);
				// Remove from main records (using index)
				$scope.bookList.splice(index, 1);
			};
			
			// Edit 
			$scope.editBook = function (index) {
				$scope.bookname = $scope.bookList[index].bookname;
				$scope.authorname = $scope.bookList[index].authorname;
				$scope.rollnumber = $scope.bookList[index].rollnumber;
				$scope.quantity = $scope.bookList[index].quantity;
				$scope.status = $scope.bookList[index].status;
				$scope.updateIndex = index;
				$scope.showForm = 'edit';
			}
			
			// Update 
			$scope.updateBook = function (index, isValid) {
				if (isValid) {
					$scope.bookList[index].bookname = $scope.bookname;
					$scope.bookList[index].authorname = $scope.authorname;
					$scope.bookList[index].rollnumber = $scope.rollnumber;
					$scope.bookList[index].quantity = $scope.quantity;
					$scope.bookList[index].status = $scope.status;
					$scope.resetData();
				} else {
					alert("Validation failed");
				}
			}
			
			// Reset new data model
			$scope.resetData = function () {
				$scope.bookname = '';
				$scope.authorname = '';
				$scope.rollnumber = '';
				$scope.quantity = '';
				$scope.status = 'Available';
				$scope.updateIndex = '';
				$scope.showForm = 'add';
			}
			
			$scope.resetData();
			// Add new data
			$scope.addBook = function (isValid) {
				if (isValid) {
					$scope.bookList.push({
						bookname: $scope.bookname,
						authorname: $scope.authorname,
						rollnumber: $scope.rollnumber,
						quantity: $scope.quantity,
						status: $scope.status
					});
					
					$scope.resetData();
				} else {
					alert("Validation failed");
				}
			}
			// Undo action (delete)
			$scope.undoDelete = function () {
				// Add last / most recent historical record to the main records
				$scope.bookList.push($scope.history[ $scope.history.length - 1 ]);
				// Remove last / most recent historical record
				$scope.history.pop();
			}
		
		});
	
	</script>
</body>
</html>

